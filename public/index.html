<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes"/>

    <meta name="theme-color" content="#000000" />
    <link rel="manifest"  crossorigin="use-credentials" href="./manifest.json" />
    <title>CMPT 496 Capstone Project</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="index.css">

    <!--      ////////////////////////////////////////////      -->

    //build date slider
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
      $( function() {
        $( "#slider-range" ).slider({
          animate:true,
          range: true,
          min: 1999,
          max: 2016,
          values: [ 1999, 2016 ],
          slide: function( event, ui ) {  $( "#year" ).val( ui.values[ 0 ] + " - " + ui.values[ 1 ] );  }});
        $( "#year" ).val( $( "#slider-range" ).slider( "values", 0 ) + " - " + $( "#slider-range" ).slider( "values", 1 ) ); } );
    </script>

    </head>
    <body>
    <script src="//d3js.org/d3.v4.min.js"></script>
    <!--<script src="../src/index.js"></script>-->
    <div><h2>CMPT 496 Capstone Project</h2></div>
    <div id="root"></div>

    <p>
      <label for="year">Date range:</label>
      <input type="text" id="year" readonly style="border:0; color:#f6931f; font-weight:bold;">
    </p>
    <div id="slider-range"></div>

  <!--   ////////////////////////////////// -->

    <!-- bar charts-->
    <script type="text/javascript">

      //Width and height
      var w = window.innerWidth;
      var h = 250;
      var barPadding = 1;

      //declare variables for data selection
      var dataset = [];
      var dataset2 = [];
      var ind = 0;
      var ind2 = 0;
      d3.csv("./weather-persons.csv", function(error, data) {
        if (error) throw error;
        dataset[0] = data[ind]["1999"];
        dataset[1] = data[ind]["2000"];
        dataset[2] = data[ind]["2001"];
        dataset[3] = data[ind]["2002"];
        dataset[4] = data[ind]["2003"];
        dataset[5] = data[ind]["2004"];
        dataset[6] = data[ind]["2005"];
        dataset[7] = data[ind]["2006"];
        dataset[8] = data[ind]["2007"];
        dataset[9] = data[ind]["2008"];
        dataset[10] = data[ind]["2009"];
        dataset[11] = data[ind]["2010"];
        dataset[12] = data[ind]["2011"];
        dataset[13] = data[ind]["2012"];
        dataset[14] = data[ind]["2013"];
        dataset[15] = data[ind]["2014"];
        dataset[16] = data[ind]["2015"];
        dataset[17] = data[ind]["2016"];
        console.log(dataset);
      });


      // set the dimensions and margins of the graph
      var margin = {top: 0, right: 0, bottom: 30, left: 0},
              width = w - margin.left - margin.right+10,
              height = h - margin.top - margin.bottom;

      //Create first SVG element
      var svgOne = d3.select("body")
              .append("svg")
              .attr("width", width + margin.left + margin.right+50)
              .attr("height", height + margin.top + margin.bottom+50)
              .attr("transform", "scale(0.7)")
              .attr("font-family", "sans-serif")
              .attr("font-size", "25px")
              .append("g")
              .attr("transform",
                      "translate(" + margin.left + "," + margin.top + ")");

      svgOne.selectAll("rect")
              .data(dataset)
              .enter()
              .append("rect")
              .attr("x", function(d, i) {return i * (w / dataset.length) + 40;})
              .attr("y", function(d) {return h - (d * 8); })
              .attr("width", w / dataset.length - barPadding)
              .attr("height", function(d) {return d * 8; })
              .attr("fill", function(d) {return "rgb(50, 50, " + (d * 8) + ")"; });

      svgOne.selectAll("text")
              .data(dataset)
              .enter()
              .append("text")
              .text(function(d) {return d; })
              .attr("text-anchor", "middle")
              .attr("x", function(d, i) {return (i * (w / dataset.length) + (w / dataset.length - barPadding) / 2) + 40; })
              .attr("y", function(d) { return h - (d * 8) + 14; })
              .attr("font-family", "sans-serif")
              .attr("font-size", "11px")
              .attr("fill", "white");

      svgOne.append("text")
              .attr("class", "title")
              .attr("x", (w/2) -50)
              .attr("y", 25)
              .attr("text-anchor", "middle")
              .text("Accidents by Weather Conditions");

      //Create second SVG bar graph
      var svgTwo = d3.select("body")
              .append("svg")
              .attr("width",  width + margin.left + margin.right+50)
              .attr("height",height + margin.top + margin.bottom+50)
              .attr("transform", "scale(0.7)")
              .append("g")
              .attr("transform",
                      "translate(" + margin.left + "," + margin.top + ")");

      d3.csv("./age-persons.csv", function(error, data) {
        if (error) throw error;
        dataset2[0] = data[ind2]["1999"];
        dataset2[1] = data[ind2]["2000"];
        dataset2[2] = data[ind2]["2001"];
        dataset2[3] = data[ind2]["2002"];
        dataset2[4] = data[ind2]["2003"];
        dataset2[5] = data[ind2]["2004"];
        dataset2[6] = data[ind2]["2005"];
        dataset2[7] = data[ind2]["2006"];
        dataset2[8] = data[ind2]["2007"];
        dataset2[9] = data[ind2]["2008"];
        dataset2[10] = data[ind2]["2009"];
        dataset2[11] = data[ind2]["2010"];
        dataset2[12] = data[ind2]["2011"];
        dataset2[13] = data[ind2]["2012"];
        dataset2[14] = data[ind2]["2013"];
        dataset2[15] = data[ind2]["2014"];
        dataset2[16] = data[ind2]["2015"];
        dataset2[17] = data[ind2]["2016"];
        console.log(dataset2);
      });

      svgTwo.selectAll("rect")
              .data(dataset2)
              .enter()
              .append("rect")
              .attr("x", function(d, i) { return i * (w / dataset2.length) + 40;  })
              .attr("y", function(d) { return h - (d * 8); })
              .attr("width",  (w / dataset2.length - barPadding) )
              .attr("height", function(d) {return d * 8; })
              .attr("fill", function(d) { return "rgb(50, 50, " + (d * 8) + ")"; });

      svgTwo.selectAll("text")
              .data(dataset)
              .enter()
              .append("text")
              .text(function(d) { return d; })
              .attr("text-anchor", "middle")
              .attr("x", function(d, i) {return (i * (w / dataset2.length) + (w / dataset2.length - barPadding) / 2) + 40; })
              .attr("y", function(d) { return h - (d * 8) + 14; })
              .attr("font-family", "sans-serif")
              .attr("font-size", "11px")
              .attr("fill", "white");

      svgTwo.append("text")
              .attr("class", "title")
              .attr("x", (w/2)-50)
              .attr("y", 25)
              .attr("font-family", "sans-serif")
              .attr("font-size", "25px")
              .attr("text-anchor", "middle")
              .text("Accidents by Driver Age");


      var xscale = d3.scaleLinear()
              .domain([0, d3.max(dataset)])
              .range([0, width]);

      var yscale = d3.scaleLinear()
              .domain([0, d3.max(dataset)])
              .range([height, 0]);

      var x_axis = d3.axisBottom()
              .scale(xscale);

      var y_axis = d3.axisLeft()
              .scale(yscale);

      var yAxisTranslate = 30;

      svgOne.append("g")
              .attr("transform", "translate(35, " + yAxisTranslate +  ")")
              .call(y_axis);

      svgTwo.append("g")
              .attr("transform", "translate(35, " + yAxisTranslate +  ")")
              .call(y_axis);

      var xAxisTranslate = height + 35;

      svgOne.append("g")
              .attr("transform", "translate(40, " + xAxisTranslate  +")")
              .call(x_axis)

      svgTwo.append("g")
              .attr("transform", "translate(40, " + xAxisTranslate  +")")
              .call(x_axis)
    </script>

  <!--    /////////////////////////////////////   -->

  <!--line chart-->
  <script src="//d3js.org/d3.v4.min.js"></script>
  <script type="text/javascript">

    var w = window.innerWidth - 250;
    var h = 400;
    var barPadding = 1;

    var margin = {top: 60, right: 0, bottom: 0, left:  400},
            width = w - margin.left - margin.right,
            height = h - margin.top - margin.bottom;

    var x = d3.scaleTime().range([0, width-20]);
    var y = d3.scaleLinear().range([height, 0]);

    var valueline = d3.line()
            .x(function(d) { return x(d.date); })
            .y(function(d) { return y(d.close); });

    var valueline2 = d3.line()
            .x(function(d) { return x(d.date); })
            .y(function(d) { return y(d.open); });

    var svg = d3.select("body")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom+30)
            .append("g")
            .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

    var data = [];
    d3.csv("./sex-persons.csv", function(error, dt) {
      if (error) throw error;
      data = dt[1];
      console.log(data);

      x.domain(d3.extent(data, function(d) { return d.date; }));
      y.domain([0, d3.max(data, function(d) {
        return Math.max(d.close, d.open); })]);

      svg.append("path")
              .data([data])
              .attr("class", "line")
              .attr("fill", "none")
              .attr("stroke", "blue")
              .attr("stroke-linejoin", "round")
              .attr("stroke-linecap", "round")
              .attr("stroke-width", 2.0)
              .attr("d", valueline);

      svg.append("path")
              .data([data])
              .attr("class", "line")
              .attr("fill", "none")
              .attr("stroke", "red")
              .attr("stroke-linejoin", "round")
              .attr("stroke-linecap", "round")
              .attr("stroke-width", 2.0)
              .attr("d", valueline2);

      svg.append("g")
              .attr("transform", "translate(0," + height + ")")
              .call(d3.axisBottom(x));

      svg.append("g")
              .call(d3.axisLeft(y));

      svg.append("text")
              .attr("x", (width / 2)-100)
              .attr("y", -20)
              .attr("text-anchor", "middle")
              .attr("font-family", "sans-serif")
              .attr("font-size", "18px")
              .text("Accidents Men vs Women");

      svg.append("g")
              .attr("transform", "translate(0," + height + ")")
              .call(d3.axisBottom(x));

      svg.append("g")
              .call(d3.axisLeft(y));


    });
  </script>

  <!-- ////////////////////////////////  -->


  </body>
</html>
