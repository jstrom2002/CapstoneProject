<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes"/>

    <!--     ///////////////////////////     -->

    <meta name="theme-color" content="#000000" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <title>CMPT 496 Capstone Project</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--    //////////////////////////////   -->

    <!--set up and render loading circle icon-->
    <style>    /* Center the loader */
      #loader {
        position: absolute;
        left: 50%;
        top: 50%;
        z-index: 1;
        width: 150px;
        height: 150px;
        margin: -75px 0 0 -75px;
        border: 16px solid #f3f3f3;
        border-radius: 50%;
        border-top: 16px solid #3498db;
        width: 120px;
        height: 120px;
        -webkit-animation: spin 2s linear infinite;
        animation: spin 2s linear infinite;
      }

      @-webkit-keyframes spin {
        0% { -webkit-transform: rotate(0deg); }
        100% { -webkit-transform: rotate(360deg); }
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* Add animation to "page content" */
      .animate-bottom {
        position: relative;
        -webkit-animation-name: animatebottom;
        -webkit-animation-duration: 1s;
        animation-name: animatebottom;
        animation-duration: 1s
      }

      @-webkit-keyframes animatebottom {
        from { bottom:-100px; opacity:0 }
        to { bottom:0px; opacity:1 }
      }

      @keyframes animatebottom {
        from{ bottom:-100px; opacity:0 }
        to{ bottom:0; opacity:1 }
      }

      #myDiv {
        display: none;
        text-align: center;
      }
    </style>

    <!--     ///////////////////////////     -->


    <!-- Load basic header -->
    </head>
    <body onload="myFunction()" style="margin:0;">

    <script src="//d3js.org/d3.v4.min.js"></script>
    <script src="../src/index.js"></script>

    <div id="root"></div>

  <!--   ////////////////////////////////// -->

    <!-- Load bar charts-->
    <!-- see: https://alignedleft.com/tutorials/d3/making-a-bar-chart for more info -->
    <script type="text/javascript">

      //Width and height
      var w = window.innerWidth - 200;
      var h = 150;
      var barPadding = 1;

      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
        11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];

      // set the dimensions and margins of the graph
      var margin = {top: 20, right: 0, bottom: 30, left: 0},
              width = w - margin.left - margin.right,
              height = h - margin.top - margin.bottom;

      //Create  first SVG element
      var svgOne = d3.select("body")
              .append("svg")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.top + margin.bottom)
              .append("g")
              .attr("transform",
                      "translate(" + margin.left + "," + margin.top + ")");

      svgOne.selectAll("rect")
              .data(dataset)
              .enter()
              .append("rect")
              .attr("x", function(d, i) {
                return i * (w / dataset.length);
              })
              .attr("y", function(d) {
                return h - (d * 4);
              })
              .attr("width", w / dataset.length - barPadding)
              .attr("height", function(d) {
                return d * 4;
              })
              .attr("fill", function(d) {
                return "rgb(0, 0, " + (d * 10) + ")";
              });

      svgOne.selectAll("text")
              .data(dataset)
              .enter()
              .append("text")
              .text(function(d) {
                return d;
              })
              .attr("text-anchor", "middle")
              .attr("x", function(d, i) {
                return i * (w / dataset.length) + (w / dataset.length - barPadding) / 2;
              })
              .attr("y", function(d) {
                return h - (d * 4) + 14;
              })
              .attr("font-family", "sans-serif")
              .attr("font-size", "11px")
              .attr("fill", "white");

      svgOne.append("text")
              .attr("class", "title")
              .attr("x", w/2 + 50)
              .attr("y", 25)
              .attr("text-anchor", "middle")
              .text("Accidents by Weather Conditions");

      //Create second SVG bar graph
      var svgTwo = d3.select("body")
              .append("svg")
              .attr("width", w)
              .attr("height", h)
              .append("g")
              .attr("transform",
                      "translate(" + margin.left + "," + margin.top + ")");

      svgTwo.selectAll("rect")
              .data(dataset)
              .enter()
              .append("rect")
              .attr("x", function(d, i) {
                return i * (w / dataset.length);
              })
              .attr("y", function(d) {
                return h - (d * 4);
              })
              .attr("width", w / dataset.length - barPadding)
              .attr("height", function(d) {
                return d * 4;
              })
              .attr("fill", function(d) {
                return "rgb(0, 0, " + (d * 10) + ")";
              });

      svgTwo.selectAll("text")
              .data(dataset)
              .enter()
              .append("text")
              .text(function(d) {
                return d;
              })
              .attr("text-anchor", "middle")
              .attr("x", function(d, i) {
                return i * (w / dataset.length) + (w / dataset.length - barPadding) / 2;
              })
              .attr("y", function(d) {
                return h - (d * 4) + 14;
              })
              .attr("font-family", "sans-serif")
              .attr("font-size", "11px")
              .attr("fill", "white");

      svgTwo.append("text")
              .attr("class", "title")
              .attr("x", w/2 + 50)
              .attr("y", 25)
              .attr("text-anchor", "middle")
              .text("Accidents by Driver Age");
    </script>

  <!--    /////////////////////////////////////   -->

  <!-- load the d3.js library and draw line chart-->
  <script src="//d3js.org/d3.v4.min.js"></script>
  <script type="text/javascript">

    //Width and height
    var w = window.innerWidth - 200;
    var h = 400;
    var barPadding = 1;

    // set the dimensions and margins of the graph
    var margin = {top: 20, right: 0, bottom: 30, left: 100},
            width = w - margin.left - margin.right,
            height = h - margin.top - margin.bottom;

    // parse the date / time
    var parseTime = d3.timeParse("%d-%b-%y");

    // set the ranges
    var x = d3.scaleTime().range([0, width]);
    var y = d3.scaleLinear().range([height, 0]);

    // define the first line
    var valueline = d3.line()
            .x(function(d) { return x(d.date); })
            .y(function(d) { return y(d.close); });

    // define the 2nd line
    var valueline2 = d3.line()
            .x(function(d) { return x(d.date); })
            .y(function(d) { return y(d.open); });

    // append the svg obgect to the body of the page
    // appends a 'group' element to 'svg'
    // moves the 'group' element to the top left margin
    var svg = d3.select("body")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

    // Get the data
    d3.csv("data.csv", function(error, data) {
      if (error) throw error;

      // format the data
      data.forEach(function(d) {
        d.date = parseTime(d.date);
        d.close = +d.close;
        d.open = +d.open;
      });

      // Scale the range of the data
      x.domain(d3.extent(data, function(d) { return d.date; }));
      y.domain([0, d3.max(data, function(d) {
        return Math.max(d.close, d.open); })]);

      // Add the valueline path.
      svg.append("path")
              .data([data])
              .attr("class", "line")
              .attr("fill", "none")
              .attr("stroke", "blue")
              .attr("stroke-linejoin", "round")
              .attr("stroke-linecap", "round")
              .attr("stroke-width", 1.5)
              .attr("d", valueline);

      // Add the valueline2 path.
      svg.append("path")
              .data([data])
              .attr("class", "line")
              .attr("fill", "none")
              .attr("stroke", "red")
              .attr("stroke-linejoin", "round")
              .attr("stroke-linecap", "round")
              .attr("stroke-width", 1.5)
              .attr("d", valueline2);

      // Add the X Axis
      svg.append("g")
              .attr("transform", "translate(0," + height + ")")
              .call(d3.axisBottom(x));

      // Add the Y Axis
      svg.append("g")
              .call(d3.axisLeft(y));
      
      // Add line chart title
      svg.append("text")
              .attr("x", (width / 2))
              .attr("y", 0 - (margin.top / 2))
              .attr("text-anchor", "middle")
              .style("font-size", "16px")
              .style("text-decoration", "underline")
              .text("Accidents by Men vs Women");

      // Add the X Axis
      svg.append("g")
              .attr("transform", "translate(0," + height + ")")
              .call(d3.axisBottom(x));

      // Add the Y Axis
      svg.append("g")
              .call(d3.axisLeft(y));


    });
  </script>


  <!-- ////////////////////////////////  -->

  <script>
    var myVar;

    function myFunction() {
      myVar = setTimeout(showPage, 1000);
    }

    function showPage() {
      document.getElementById("loader").style.display = "none";
      document.getElementById("myDiv").style.display = "block";
    }
  </script>


  </body>
</html>
